# Work Flow
Before making any changes to the project, run the following code to make sure that on making a commit the code will satisfy the acceptance criteria of .pre-commit-config.yaml hook file.

```bash
$ pip install pre-commit
```

and then

```bash
$ pre-commit install
```

If changes are made after triggering pre-commit hook while making a commit - stage the changed files and commit again and you will be able to push the changes to the repo afterwards.


# Project

პროექტის გასაშვებად გაუშვით ქვემოთ მოცემული ბრძანება:

```bash
$ docker-compose up --build
```

# Connect
სოკეტთან დასაკავშირებლად საჭიროა url:

### Connect to socket

```http
http://localhost:8005/?game_id={game_id}&token={token}
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `game_id`      | `string` | **Required**. Id of game to connect |
| `token`      | `string` | **Required**. Token generated by core. NOTE: It is not JWT token. |

### Server Response
#### Success Response
სერვერთან წარმატებით დაკავშირების შემთხვევაში კლიენტს გამეოგზავნება მაგიდის ინფორამაცია
მოთამაშის ბალანსი და აქტიური მოთამაშეების სია და მათი ბეთების რაოდენობა.

| Event name | Response body type     |
| :-------- | :------- |
| `on_connect_data`      | `Json` |


```json
{
    "starts_at": "1645041573",
    "round_id": "620d5484816fc8c84dcce85c",
    "_round_id": "bkj767d",
    "total_bet": 200.0,
    "dealer_name": "natalia",
    "user_deposit": 550.0,
    "min_bet": 20,
    "max_bet": 450,
    "bet_range": [10, 20, 30, 50, 100],
    "game_name": "test game",
    "user_name": "test player",
    "user_id": 451,
    "game_history": "not implemented yet",
    "can_make_repeat": true,
    "seats": {
        "1": {
            "cards": ["2C", "10S"],
            "score": 12,
            "user_name": "test_player_32"
        },
        "3": {
            "cards": ["10C", "7S"],
            "score": 17,
            "user_name": "test_player_13"
        }
    },
    "chips": {
        "1": [
            {
                "type": "bet",
                "amount": 100
            }
        ],
        "2": [
            {
                "type": "bet",
                "amount": 110
            },
            {
                "type": "bonus",
                "amount": 110
            }
        ]
    }
}

```


# Place bets

```javascript
socket.emit("place_bet", {
    "seat_number": 2, "amount": 20, "bet_type": "bet"
})
```

| Parameter | Type     | Description                       |
| :-------- | :------- | :-------------------------------- |
| `seat_number`      | `int` | **Required**. The maximum number of players is seven and minumum is 1|
| `amount`      | `float` | **Required**.  |
| `bet_type`      | `string` | **Required**.  In this version of the project we do not use other types of bets, but will be added in the future|

### Success Response

| Event name | Response body type     |
| :-------- | :------- |
| `bet_status`      | `Json` |

```json
{
    "seat_number": 2,
    "total_bet": 20,
    "bet": 20,
    "balance": 100,
    "bet_list": [20]
}
```

ფსონის წარმატებით დადების შემთხვევაში იგზავნება ივენთი ჯგუფში რაც უნდა დაინახონ დანარჩენმა მოთამაშეებმაც

| Event name | Response body type     |
|:-----------| :------- |
| `new_bet`  | `Json` |

```json
{
  "bet_type": "bet",
  "seat_number": 2,
  "total_bet": 20,
  "user_name": "player"
}
```


### Possible events

ბეთის დადებისას შესაძლოა სერვერმა გამოაგზავნოს start_timer evnet რაც ნიშნავს  იმას რომ ტიამერის ათვლა უნდა დაიწყოს

| Event name    | Response body type     |
|:--------------| :------- |
| `start_timer` | `Json` |

```json
{
  "seconds": 15
}
```

# Rollback
```javascript
socket.emit("make_rollback", {
    "seat_number": 2, "rollback_type": "bet"
})
```


| Parameter       | Type  | Description                       |
|:----------------|:------| :-------------------------------- |
| `seat_number`   | `int` | **Required**. |
| `rollback_type` | `str` | **Required**.  |

### Success Response

| Event name | Response body type     |
| :-------- | :------- |
| `bet_status`      | `Json` |
```json
{
  "2": {
    "rollback_type": "bet",
    "total_bet": 200,
    "bet": 200,
    "bet_list": [20, 20],
    "balance": 1000
  }
}
```


# Card scanning

```javascript
socket.emit("scan_card", {
    "round_id": "507f191e810c19729de860ea", "card": "9S"
})
```

| Parameter  | Type  | Description                       |
|:-----------|:------| :-------------------------------- |
| `round_id` | `str` | **Required**. |
| `card`     | `str` | **Required**.  |

კარტის გატარების დროს სერვერი აბრუნებს რამოდენიმე ივენთს

### 1) Hand values
| Event name        | Response body type     |
|:------------------| :------- |
| `send_hand_value` | `Json` |


```json
{
  "seat_number": 5,
  "score": "12",
  "card": "9S"
}
```


# Making Action

```javascript
socket.emit("make_action", {
    "round_id": "507f191e810c19729de860ea", "action_type": "hit"
})
```

| Parameter     | Type  | Description                       |
|:--------------|:------| :-------------------------------- |
| `round_id`    | `str` | **Required**. The maximum number of players is seven and minumum is 1|
| `action_type` | `str` | **Required**.  |

გადაწყვეტილების მიღების დროს სერვერი აბრუნებს შემდეგ ივენთს

### 1) Player Action
| Event name      | Response body type     |
|:----------------| :------- |
| `player_action` | `Json` |


```json
{
  "seat_number": 5,
  "action_type": "hit"
}
```
